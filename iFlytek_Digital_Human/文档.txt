💡 快速上手
虚拟人SDK-Web集成文档


虚拟人SDK-Web集成文档
修订文档历史记录
日期
版本
说明
作者
2024
3.0.0
虚拟人js sdk文档
iflytek
2024/09/29
3.0.4
1.解除android/ios限制， 但不支持的设备功能无法使用。
2. sdk 支持动作帧起始/结束事件  
iflytek
2024/11/13
3.1.0
1.新增支持超拟人情感分析。
iflytek
1.概述
虚拟人 SDK是基于科大讯飞虚拟人相关能力进行融合和封装，以便为客户提供更便捷的接入方式，快速打造属于自己的虚拟人业务场景。
专有名词
Avatar：虚拟人
tts：text-to-speech，语音合成
vc：voice-change 变声
asr：automatic-speech-recognition 语音识别
air：自动动作
nlp：natural-language-processin 自然语言处理即语义理解
全双工：实时语音识别和理解，实时交互的效果
打断：可打断虚拟人正在播报的文本，立刻开始下一轮交互
追加：不可打断虚拟人正在播报的文本，需等当前交互完毕后再开始下一轮交互
2. 集成接入
接入条件
2.1. 接入准备
由于虚拟人涉及多项能力，接入前请提前申请AppId、ApiKey、ApiSecret、形象、发音人、并发路数、有效期等相关授权信息。具体准备信息如下：
1、接⼝地址: wss://avatar.cn-huadong-1.xf-yun.com/v1/interact
2、分配的appid、apiKey、apiSecret和SceneId（接口服务ID）（到交互平台-接口服务中获取）
交互平台申请接口服务Appid.docx
(1.9 MB)
3、分配的avatar_id和vcn（到交互平台-接口服务-形象列表和声音列表中获取已授权的形象和声音，未授权的可点击”获取授权“）
 2.2. demo和安装包下载
websdk在安卓端或者移动设备上的游览器不保证都支持，由于没有覆盖所有的设备，不同设备的游览器内核都不一样，因此不保证都支持，websdk通常用在pc端以及大屏上。
avatar-sdk-web_3.1.2.1002.zip
(155 KB)
SDK是纯JS开发的，不挑框架。
avatar-sdk-web_demo.zip
(1.4 MB)
Vue2版本Demo
git clone https://gitee.com/wulong12345/web-sdk-vue2.git
demo下载后，可以先看讲解视频，若有问题可以先看该文档最下方的常见报错以及常见需求场景的解决方案中寻找答案
适配环境
websdk通常用在windows、Linux等pc端以及大屏上，websdk在安卓端或者移动设备上的游览器不保证都支持，由于没有覆盖所有的设备，不同设备的游览器内核都不一样，因此不保证都支持，
demo运行讲解视频
https://www.bilibili.com/video/BV1aHLbzRE1c/
调用流程：
①、引入SDK实例，初始化SDK实例——>
②、设置监听——>
③、设置SDK配置（setApiInfo）——>
④、设置全局变量（setGlobalParams）——>
⑤、启动虚拟人（start）——>
⑥、发送驱动协议（文本驱动/交互、音频驱动/交互、全双工语音实时交互、打断、动作驱动）——>
⑦、断开连接
2.2. 集成步骤及基础代码示例
2.2.1 导入模块
2.2.2 初始化SDK实例 （先创建实例）
属性
类型
必填
父节点
说明
props
IAvatarPlatformProps
否
root
创建实例时 属性配置
useInlinePlayer
boolean
否
props
是否启用内置播放器； 默认true
形如： 
2.2.3 设置事件监听
参考2.3 事件说明, 按需 进行相关事件监听, （下方为列出可绑定的的全量事件）
2.2.4 设置SDK配置（setApiInfo)
2.2.5 设置全局变量(setGlobalParams)
2.2.6 发起连接--显示虚拟人
   注意：：：
     受限于浏览器对声音有自动播放限制策略 ， 对于打开页面默认连接并展示虚拟人的情况时。 
 	player实例 可能收到PlayerEvents.playNotAllowed事件。
您需要交互层面再次用户点击网页 并主动调用 player.resume() 恢复声音播放！！
 
至此 交互连接建立结束, 正常情况下, 页面的绘制区域应该已经已经正常显示虚拟人.
2.2.6 过程中交互 
[文本模式]
 [全双工模式]   （全双工效果就是实时交互）
(注意 startRecord 开启期间 请勿手动调用writeAudio, writeText 等手动交互控制)
 [短语音模式]   
(注意 startRecord 开启期间 请勿手动调用writeAudio, writeText 等手动交互控制)
[手动输入音频数据] --一般情况，非特殊流程场景 请勿手动调用
当然除了 封装的 录音交互流程外, 如果有需要, 您也可以手动进行传送实时录音音频pcm 16k16bit数据 进行交互驱动, 具体
2.2.7 断开当前连接（断连时必须调用stop，确保资源释放，不会占用路数）
2.2.8 销毁实例（包含断开连接）
(销毁后当前句柄实例，不再继续调用实例进行操作)
3. SDK详情说明

3.1 API说明
3.1.1	API 概括
方法
返回
Throws
说明
getVersion
string
SDK 静态方法 返回当前sdk的版本号
setLogLevel
void
SDK 静态方法 设置SDK 的日志输出级别
createPlayer
IPlayer
使用内敛播放器时，创建播放器(默认不需要手动创建)
player
IPlayer
获取交互实例的播放器实例
on
this
注册监听事件，start前执行
off
this
注销监听事件
setApiInfo
this
设置SDK配置信息，start前执行
setGlobalParams
this
设置全局配置，start 前执行
start
Promise<void>
CustomError
建立连接 并完成初始化, 拉流播放操作
writeText
Promise<string>
CustomError
文本驱动
返回：resolve状态下返回request_id
createRecorder
IRecorder
创建录音器 （已经存在录音器时，则直接返回存在的录音实例）
recorder
IRecorder
获取交互实例的录音器实例
writeAudio
Promise<string>
CustomError
手动发送音频数据
audio: 默认： 16k 16bit 单通道音频pcm数据
注意:  如当前正在使用内置API进行全双工模式/短语音交互(正在录音)时 谨慎手动调用手动写入音频数据
resolve状态下返回request_id
writeCmd
Promise<string>
CustomError
触发立即指令 如：动作
interrupt
Promise<void>
CustomError
打断操作
removeAllListeners
this
解绑所有事件监听
stop
void
断开已有连接,停止拉流渲染，释放播放器、录音设备等资源
destroy
void
销毁实例，清除各类设置、监听、已初始化的内容, 释放相关资源
3.1.2 API文档
getVersion 静态方法
setLogLevel 静态方法
实例方法 /属性
player （播放器）
IPlayer 实例属性/API
属性/API
参数类型
必须
Description
on
(eventName, listener)
否
事件绑定
off
(eventName, listener)
否
移除绑定
muted
boolean
否
设置视频静音/解除静音播放
volume
number
否
设置视频播放音量 [0~1] 默认1
resume
API
否
当player 收到 “not-allowed” 事件时，需要引导用户点击屏幕后调用 该API 恢复带声音播放 （浏览器禁止自动声音播放）
resize
API
否
当窗口或者渲染区域第三方调整完毕，可以调用该API 保持清晰的渲染
Examples
setApiInfo（设置SDK配置）
setApiInfo(apiInfo: ApiInfo)->this
设置实例交互连接信息
Required: true 
必须在发起连接（start api  ）前进行调用该API进行配置！
Examples
Parameters
Name
Type
Parent
Description
appId
string
root
申请的交互应用信息AppId
apiKey
string
root
申请分发的交互应用信息apiKey
apiSecret
string
root
申请分发的交互应用信息apiSecret
sceneId
string
root
如果使用交互平台创建的项目配置，需要传交互平台中的接口服务ID
setGlobalParams（设置全局变量）
setGlobalParams(config: IGlobalConfig)->this
设置实例交互连接时所需的连接参数/ 全局设置参数。
是否必须: 是
必须在发起连接（start api  ）前进行调用该API进行配置！
请求样例：
start（启动虚拟人）
start(params:IStartParams)->Promise<void>
根据设置API后的参数 进行启动交互，并渲染虚拟人区域，return promise, 
整个过程流程包含： 当发起连接--> connected ---> init ---> 获取流地址 --->（拉流--> 播放成功)--->resolve
Examples
Parameters
Name
Type
Parent
Description
params
IStartParams
root
连接成功后需要播放画面填充的区域
（注意： 该区域必须设置原始大小，画面会以contain 模式填充画面， 不会自动撑开）
wrapper
HTMLDivElement
params
writeText（发送文本驱动）
writeText(text: string, extend: TextDriverExtend)->Promise<string>
进行文本驱动与交互接口
如何开启语义理解.pdf
(1.8 MB)
Required: false 
必须在发起连接成功后 执行 （start promise resolve 后）
Examples
Parameters
Name
Type
Parent
Description
text
string
root
发送的文本信息，虚拟人播报内容包含标点符号需少于2000字
extend
TextDriverExtend
root
文本驱动的扩展信息
Response:  Promise<asid>
   该段文本的会话ID
createRecorder（创建内置录音器）
createRecorder()->IRecorder
创建recorder 录音器。  SDK 默认不会主动创建， 需要时 需要手动调用 createRecorder
Required: false 
 注： 需要在excute resolve 之后创建
Examples
Parameters
无
recorder （开启语音交互，需先创建录音器）
IRecorder 实例属性/API
属性/API
参数类型
返回类型
Description
recording
boolean
只读/ 录音器的录音状态
startRecord
(duration: number, stopEvent?:Function)
Promise<void>
启动录音 
1. duration: 0 开启长聆听状态，不会主动停止，全双工交互
2. duration > 0, 最长录音duration毫秒 后主动停止
超拟人开启情感时，请全局setGlobalParams 中开启content_analysis 参数
stopRecord
无
void
主动停止录音
on
(eventName, listener)
否
事件绑定
off
(eventName, listener)
否
移除绑定
writeAudio（发送音频驱动）
writeAudio(arraybuffer:ArrayBuffer ,frameStatus: AudioFrameStatus,extend?: AudioDriverExtend)->Promise<string>
进行语音驱动接口 
注意常规情况 必须要手动调用该接口。 如需调用，请联系技术支持人员
Required: false 
必须在发起连接成功后 执行 （start promise resolve 后）
Examples
Parameters
Name
Type
Parent
Description
arraybuffer
ArrayBuffer
root
发送的音频数据 （必须是16k16bit pcm）
frameStatus
AudioFrameStatus
root
音频数据的状态 （0 代表起始帧率， 1代表中间帧数据， 2代表最后一帧数据）
extend
AudioDriverExtend
root
音频数据发送时的扩展参数
interrupt（打断）
interrupt()->Promise<void>
立即进行虚拟人播报的打断操作（丢弃当前未播报完的数据）
Required: false 
必须在发起连接成功后 执行 （start promise resolve 后）
Examples
Parameters 
无
writeCmd（驱动动作，动作标签请去：交互平台-接口服务-形象列表中点击查看动作获取）
writeCmd(type: CmdType, value:string)->Promise<string>
立即出发特定指令/   目前type仅支持 “action” 动作。
Required: false 
必须在发起连接成功后 执行 （start promise resolve 后）
Examples
Parameters
Name
Type
Parent
Description
actionId
string
root
驱动的动作标识
注意事项：
当使用3D形象时（3D就是卡通形象），若虚拟人正在播报文本时发送该协议会打断当前播报的内容，暂无法修改
当使用2D形象时（2D就是真人形象），不存在该问题。
stop（主动断开连接，释放路数）
stop()->void
断开当前路会话，释放虚拟人服务开销 （并销毁播放/录音等前端占用资源）
Required: false 
注意： close 只是断开链接 释放资源。 后续可以对当前实例 （或者修改设置一些参数） 重新执行start 进行连接 & 拉流
Examples
Parameters
无
destroy（销毁SDK实例）
destroy()->void
销毁当前实例 （内部也会包含调用了 close API 逻辑 ）
Required: false 
注意： 销毁当前实例  后续不能再次使用该实例 API ， 如需重新连接， 需要 重新new 一个 AvatarPlatform 实例对象
Examples
Parameters
无
3.2 Events 事件
创建/获取实例后 均可以使用实例的on off API 进行注册/解除 相关类型事件监听
AvatarPlatform 交互实例
事件
参数
说明
connected
initResponse:InitResponse
连接建立成功&服务链路初始化完毕
error
(code:ErrorCode, message:String, data?:any)
错误事件 code, message, 
data 为原始错误信息，如交互中nlp, asr 错误等原始消息数据
frame_start
data:WsResponse
单次交互服务端推流起始帧事件
tts_duration
data:WsResponse
单次交互服务端推流预计总时长
frame_stop
data:WsResponse
单次交互服务端推流结束帧事件
action_start
data:WsResponse
单次动作服务端推流起始帧事件
action_stop
data:WsResponse
单次动作服务端推流起始帧事件
nlp
data:WsResponse
语义理解结果事件
asr
data:WsResponse
识别结果事件
disconnected
error | undefined
连接被动断开事件, 当回调参数error 存在时， 说明断开是因为错误断开。错误原因：error 对象信息。
IPlayer实例
事件
参数
说明
play
无
开始播放事件
waiting
无
数据缓冲等待事件
playing
无
数据缓冲后继续播放事件
not-allowed
无
由于浏览器限制 禁止声音自动播放 通知事件
IRecorder实例
事件
参数
说明
mute
无
静音macphone 通知事件
unmute
无
解除静音macphone 时触发 通知事件
error
error:CustomError
录音过程中异常关闭事件
特殊场景会触发，如：
录音中 移除了设备 且自动切换失败 无法继续
录音中关闭了浏览器的录音权限 无法继续

附录 
常见错误及解决方式
websocket web Api云端错误码
1、错误码code=11200 msg='avatar authentication failed'或者 'vcn authentication failed' 
      原因一：若是'avatar authentication failed'，可能是使用的形象id没有授权。
      解决：请到交互平台-接口服务-形象列表中查看是否“已授权”，若未授权可以点击“获取授权”
      原因二：若是'vcn authentication failed'，则是使用的发音人vcn没有授权
      解决：请到交互平台-接口服务-声音列表中查看是否“已授权”，若未授权可以点击“获取授权”
      原因三：使用的appid没有交互时长。
      解决：请到交互平台-接口服务-授权能力“在线虚拟人驱动”右侧的授权详情中查看”剩余交互时长“默认600分钟，若不显示了意味着600分钟消耗完了，请求则会报错11200，请联系对接的运营人员处理。（交互时长是按照websocket连接时长算的，非调试阶段，记得断连哦）
 
2、错误码code=11203 msg='avatar authentication failed'
      原因：授权路数不足（路数：同一时间开启虚拟人服务支持的并发数量）
      解决：1、进入交互平台-我的订阅中查看使用的appid是否还在有效期内，若过期，则路数为0，启动报错11203，请联系对接的运营人员处理。
                2、进入交互平台-接口服务-授权能力中“在线虚拟人驱动”右侧显示的路数，若为1路，则只能同时开启一路虚拟人，第二路则报错11203，扩充路数请联系对接的运营人员进行采购。
                3、若遇到当前并没有启动虚拟人且appid也没有过期，依旧报错11203，那么请去交互平台-交互日志中选择“持续中”的链路点击“终止会话”强行断连虚拟人，另外项目中断连虚拟人一定要调用stop协议，释放资源，防止未断连的情况。
3、错误码code=600000、600003或20015、29004 msg='必要参数缺失 InvalidParam InvalidParam: 必要参数缺失'或'连接异常 ConnectError ConnectError: 连接异常'
      原因：必要参数缺失
      解决：首先检查SetApiInfo中的五个参数是否缺失和正确，不许有空格
                示例：appid/apiKey/apiSecret/sceneId均再交互平台-接口服务中获取。sceneId对应的是”接口服务Id“
               其次检查SetGlobalParams中视频协议protocol、形象avatar_id、发音人vcn是否缺失和正确，不许有空格
               示例：
4、错误码code=10110 msg='service license not enough'
      原因：服务器路数占用达到上线
      解决：联系技术人员解决
5、错误码code=10114 msg='over time'
       原因：连接超时
       解决：1、网络状态不好，导致SDK心跳超时
6、错误码code=10107，msg=tdp config error:tdp.botId can not be blank
       原因1：SetApiInfo中没有传sceneId参数
       解决：SetApiInfo中传参sceneId，sceneId对应的是交互平台-接口服务-”接口服务ID“
       原因2：交互平台-接口服务-大模型对话中没有打开大模型
       解决：
如何开启语义理解.docx
(2.2 MB)
       原因3：交互平台-接口服务-大模型对话中没有选中知识库版本
       解决：
知识库操作手册.docx
(3.8 MB)
7、错误码code=20009 msg='width must be a multiple of 4' 'ConnectError' 'ConnectError: width must be a multiple of 4\n
       原因：SetGlobalParams中宽高不是4的倍数
       解决：SetGlobalParams中的width、height必须是4的倍数
8、错误码code=10107 msg='asr config error'
       原因1：SetApiInfo中没有传sceneId参数
       解决：SetApiInfo中传参sceneId，sceneId对应的是交互平台-接口服务-”接口服务ID“
       原因2：appid的语音识别配置错误
       解决：到交互平台-接口服务-大模型对话-交互配置中，点击保存，重新发布appid，重启虚拟人
9、错误码code=10163 msg="'$.parameter.avatar.move_h' value must be less or equal than 4096; " 'ConnectError' "ConnectError: '$.parameter.avatar.move_h' value must be less or equal than 4096; 
       原因：SetGlobalParams中参数move_h、move_v参数值非法
       解决：SetGlobalParams中参数move_h、move_v参数值取值范围是[-4096,+4096]
10、错误码code=20016 msg='vcn is invalid' 'ConnectError' 'ConnectError: vcn is invalid
        原因：SetGlobalParams中参数vcn参数值非法（vcn概念：发音人，请到交互平台-接口服务-发音人列表中获取）
        解决：检查SetGlobalParams中参数vcn的参数值是否正确，不允许有空格（vcn概念：发音人，请到交互平台-接口服务-发音人列表中获取）
11、收到警告：'PlayerEvents.playNotAllowed事件'，start成功后但是虚拟人未展示或者虚拟人展示了，驱动后没有声音但口唇在动
         原因：由于游览器限制自动播放的策略，导致虚拟人播放失败。
         解决：必须！要与游览器产生交互，例如点击页面或者dom组件。然后去调用player.resume()方法解除静音。具体可以看下本文档内容的第2.2.5条红字部分
12、msg='Uncaught i: navigator.mediaDevices is undefined'
         原因：非安全域名下，浏览器不具备能力，是无法使用媒体设备导致的。
         解决：如果是固定设备：
                       启用不限制不安全源的功能
                       在 chrome://flags 页面的搜索框中输入以下关键词来查找并启用相应的实验性标志：
                       允许在不安全源中使用受限制的功能
                       搜索 “Insecure origins treated as secure” 选项。
                       设置步骤：将该选项的状态从 “Default” 改为 “Enabled”。
                       在下方会出现一个输入框，在其中输入你部署的 HTTP 协议网页的 URL（例                                                     如 http://example.com），多个 URL 之间用逗号分隔。
                       点击页面底部的 “Relaunch” 按钮重启 Chrome 浏览器，使设置生效。
                       启用该选项后指定的 HTTP 网页将被 Chrome 视为安全源，从而可以使用原本受限制的功能。
                   如果是对外c端用户， 那就要https了。
13、语音交互无法使用
         原因：1、后台配置错误。2、语音识别配置错误。3、设置了唤醒词（限定词）
         解决：1、参考第6条依次排查。2、参考第8条排查。3、到交互平台-接口服务-交互配置中查看是否设置了唤醒词，若设置了唤醒词，那么每次交互都需要先说唤醒词才行，想要快速测试语音交互，可以先将唤醒词删掉，点击保存，重新发布appid，再重启虚拟人。
         提高唤醒词识别概率的方法：
唤醒词操作手册-接口服务.docx
(407 KB)
14、错误码code=20017, message: 'illegal text '或者code=10110, message: 'word contain sensitive'
         原因：文本中包含敏感词汇
         解决：试用阶段无法解决，购买后可以联系对接的运营人员免除审核
15、启动后虚拟人形象只有头部或者出现重影
        
                                                         
         原因：使用的形象是超拟人形象。免费试用的有：cnrfb86h2000000004、cnr5dg8n2000000003、cnrmkf0e2000000006、cnrn9jgi2000000005。
         解决：更换除此以外的形象id即可。另外超拟人形象不支持透明背景（会导致重影）、背景图、移动，裁剪。
16、错误码code:10106 msg="payloadpayload.text.content invalid'
         原因：文本传的空值
         解决：writeText中的text不要传空值。
17、错误码code:10223 msg="RemoteLB: can't find valued addr"
         原因：使用的形象服务器中未部署
         解决：联系这边运营或者技术人员解决
18、错误码code:10106 msg="payloadtext.content lenght less than 2000"
         原因：播报文本长度大于2000
         解决：播报文本长度不得超过2000字，包含标点符号
19、错误码code:10316 msg="sub:mvc is invalid"
         原因：申请的是“云+端”的appid能力，而web-sdk、web-api、android-sdk需要的是“在线虚拟人驱动能力”。
         解决：需重新申请“在线虚拟人驱动”能力的appid，详细操作看文档：    
交互平台申请接口服务Appid.pdf
(1008 KB)
20、错误码code：10222 msg=“rpc error: code = Unknown desc = http download fail with 404 Not Found”
         原因：背景图下载失败
         解决：更换一个背景图
21、错误码code：13001 msg=“asr failed”
          原因：申请的appid没有开启“大模型对话”能力，那么也就没有语音识别的能力。

          解决：重新申请一个appid，开启“大模型对话”能力
常见需求场景及实现方案
常见需求场景及实现方案
1、如何接入第三方大模型
     方案：
如何调用第三方大模型.docx
(2.6 MB)
     若要封装成OpenAI协议参考：
OpenAI协议.pdf
(212 KB)
2、如何使用知识库实现控制数字人回复的内容
     操作：
知识库操作手册.docx
(3.8 MB)
3、如何开启语义理解
     操作：
如何开启语义理解.docx
(2.2 MB)
4、如何设置唤醒词
     操作：
唤醒词操作手册-接口服务.docx
(407 KB)
5、如何实现透明背景
     操作：使用xrtc协议同时参数alpha传1
6、如何更换背景图片
     操作：
如何更换背景图片.docx
(648 KB)
7、是否支持移动设备和安卓系统
     现象：某些安卓设备上使用游览器，可能无法展示出虚拟人。
     解答：websdk在安卓端或者移动设备上的游览器不保证都支持，由于没有覆盖所有的设备，不同设备的游览器内核都不一样，因此不保证都支持，websdk通常用在pc端以及大屏上。
8、是否支持接入到小程序中
      解答：1、小程序 建议使用web-api，protocol 用rtmp, 拿到地址 用 小程序 live-player 进行拉流播放
9、如何让虚拟人执行动作
      解答：在文本中插入动作指令[[action=动作标签]]，动作标签请到交互平台-接口服务-形象列表点击“查看”获取。例如发送文本："⼤家好，[[action=A_RH_hello_O]]我是数字⼈，今天天气晴朗"
10、如何判断虚拟人已经播报完毕
        解答：监听事件中有个frameBegin和frameEnd事件，代表推流开始和结束可以看作是虚拟人开始说话和结束说话的标识，由于大模型是流式返回，所以会有多个frameBegin和frameEnd，当触发frameEnd事件获取参数vmr_status=2且后面1秒内没有新的frameBegin时就代表当前播报结束
11、如何判断虚拟人当前动作执行完毕
        解答：监听事件中有个actionBegin和actionEnd事件，代表推流开始和结束可以看作是虚拟人开始做动作和结束动作的标识，当触发actionEnd事件获取参数vmr_status=2且后面1秒内没有新的actionBegin时就代表当前动作结束
12、如何流式发送文本
        解答：writeText()支持流式发送文本，需要开启追加模式。注意：每次调用writeText()不要只发送一两个文字且不要发送空文本，会有卡顿的感觉，需要利用标点符号作为分割符拼凑成一段话再调用writeText()。
13、如何让虚拟人视频铺满屏幕
        解答：调整class为“wrapper”的div画布的大小，虚拟人视频会自动填充div的大小，放大会影响清晰度，一般SetGlobalPrams中的宽高传1080P的即可，即1920*1080。但是自动填充的范围也是有比例限制的。例如setGlobalPrams中的width和height是1920*1080，而屏幕大小是1920*1200，那么当宽已经达到最大值，高就无法铺满屏幕。
14、是否支持自动动作
        解答：支持，需要使用有动作的形象，再SetGlobalParams中添加以下air参数，虚拟人会根据传入的文本自动匹配动作。
15、如何指定文字或数字发音
         请参考：
标记文本.docx
(16 KB)
16、如何实现半身形象
         解答：1、方式1：设置SetGlobalParams中的mask:"[xx,xx,xx,xx]"参数，mask是对形象做裁剪，依次是
[从左到右，从上到下，从右到左，从下到上]。另外超拟人形象不支持裁剪。
                   2、方式2：直接联系对接的商务授权半身形象，但半身形象大都是一直在做无指向性动作的（即动作无法控制）。
17、特定对话如何和web端对接，让web获取特定参数去执行操作
         解答：配置FAQ类型知识库，答案中预设指令双中括号：[[内容自定义]]，前端监听nlp返回的数据，凡是双中括号内的内容都不会播报，然后获取中括号内自定义的参数去执行操作
         如何监听到nlp返回数据？见：
        
         知识库如何操作？：
知识库操作手册.docx
(3.8 MB)
18、如何让数字人反馈正在思考或者正在执行之类的话术，等回复到了之后再进行语音回复
         解答：语音交互时，会最先返回监听到的asr（语音识别）信息。当监听到的时候就立马发送一个文本驱动播报（writeText协议且nlp传false），且模式选择追加模式，否则会打断后续语义理解内容。
19、接口中是否可以展示图片、视频、链接。
         解答：由于兜底回复以及大模型都不知道你要回复什么链接。所以这个链接肯定是要在知识库中配置的。接口中的前端页面无法展示图片、视频、链接。但是可以再nlp监听事件中获取知识库中预设的图片、视频、链接的地址。那么前端的展示等操作需要开发者自行实现。
20、示例demo如何打包
          解答：首先不推荐打包该demo，该demo仅用来了解调用逻辑和功能。若需要打包，添加build命令："build":"cross-env version=3.1.0 && vite build"
错误码
 本地端侧错误码（不包含websocket web Api 的云端错误码）
SDK 内部错误码
TypeScript
运行代码
复制代码
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
// 交互相关错误常量
export const InteractiveErrors = {
  ParamMissing: {
    code: '600003',
    message: '必要参数缺失',
  },
  InvalidServerError: {
    code: '600002',
    message: '无效的ServerUrl',
  },
  NetworkError: {
    code: '600003',
    message: '连接异常',
  },
  InvalidResponse: {
    code: '600004',
    message: '无效的响应',
  },
  UnknownError: {
    code: '999999',
    message: '未知错误',
  },
}
// 播放器相关错误常量
export const PlayerError = {
  EmptyStreamError: {
    code: '700000',
    message: '无效的流数据',
  },
  PlayNotAllowed: {
    code: '700006',
    message: '播放不允许',
  },
  MissingPlayerLibsError: {
    code: '700001',
    message: '缺失播放插件',
  },
  H264NotSupported: {
    code: '700002',
    message: '当前设备不支持 H.264',
  },
  Unknown: {
    code: '700005',
    message: '播放失败',
  },
}
// 录音器相关错误常量
export const UserMediaError = {
  SecurityError: {
    code: '800000',
    message: '不支持的环境',
  },
  NotFoundError: {
    code: '800001',
    message: '未找到指定约束的设备',
  },
  NotAllowedError: {
    code: '800002',
    message: '设备访问权限异常/无法请求使用源设备',
  },
  NotReadableError: {
    code: '800003',
    message:
      '暂时无法访问摄像头/麦克风，请确保当前没有其他应用请求访问设备，并重试',
  },
  OverconstrainedError: {
    code: '800004',
    message: '无效的设备请求参数',
  },
  AbortError: { code: '800005', message: '未知原因操作已终止' },
  InvalidStateError: {
    code: '800006',
    message: '当前页面未处于激活状态',
  },
  NotAllowedWithoutGestureError: {
    code: '800007',
    message: '页面未发生用户交互，请求被终止',
  },
}

 				
 					
 							
 
 
 					
 				
 			
 		
 	 

王大大、赵伟振、武龙09-05 16:111956039IP 属地江苏
举报
分享到：
所有评论（39）
杨学林
杨学林
2024-12-24 10:55
IP 属地重庆
引用原文：AppId、ApiKey、ApiSecret、
在哪里申请
王大大
王大大
2024-12-24 20:32
IP 属地江苏
交互平台的控制台  我的订阅菜单页面 --申请订阅 即可
王大大
王大大
王大大
2024-12-24 20:33
IP 属地江苏
如果是 自己集成，可以申请接口服务能力。
linshunliu
linshunliu
02-23 22:00
IP 属地未知
demo里面的index.html怎么没有详细代码啊
aptx14
aptx14
02-25 09:52
IP 属地未知
背景颜色怎么设置透明的呢？
武龙
武龙
03-10 16:43
IP 属地安徽
使用xrtc协议同时参数alpha传1
言语
言语
03-03 14:18
IP 属地北京
启动不了呀
avatar authentication failed' 'ConnectError' 'ConnectError: avatar authentication failed\n    at Qs.set.r.mark.r.wrap.e.abrupt.n.onmessage 
武龙
武龙
03-10 16:44
IP 属地安徽
1、使用的形象未授权
2、交互时长用完了
看下常见报错11200的解决方式
yanbing
yanbing
03-20 11:07
IP 属地山东
SDK start 点击的时候控制台报错 10316 'sub:vmc is invalid' 'ConnectError' 'ConnectError: sub:vmc is invalid\n 怎么解决 

2
chrissh
chrissh
03-20 14:33
IP 属地山东
同问
chrissh
chrissh
chrissh
03-20 14:42
IP 属地山东
@武龙
chrissh
chrissh
chrissh
03-20 14:43
IP 属地山东
@王大大
@赵伟振
@武龙
yanbing
yanbing
03-20 17:07
IP 属地山东
@武龙
yanbing
yanbing
chrissh
03-25 18:21
IP 属地山东
不选择标准产品 而是得选择接口能力就可以了
武龙
武龙
yanbing
04-10 15:10
IP 属地安徽
申请的appid错误，申请的是“云+端”的appid能力，而这个web-sdk是在线虚拟人驱动能力
需要重新申请appid，看这个文档
交互平台申请接口服务Appid.pdf
(1008 KB)
武龙
武龙
chrissh
04-10 15:12
IP 属地安徽
申请的appid错误，申请的是“云+端”的appid能力，而这个web-sdk是在线虚拟人驱动能力
需要重新申请appid，看这个文档
交互平台申请接口服务Appid.pdf(1008 KB)
武龙
武龙
04-10 15:12
IP 属地安徽
申请的appid错误，申请的是“云+端”的appid能力，而这个web-sdk是在线虚拟人驱动能力
需要重新申请appid，看这个文档
交互平台申请接口服务Appid.pdf(1008 KB)
qqqqjdjdudidi
qqqqjdjdudidi
04-08 15:14
IP 属地河北
虚拟人能被语音唤醒吗
武龙
武龙
05-06 09:25
IP 属地安徽
可以的，需要再交互平台设置唤醒词，详细可以看下常见需求的第4条
测试凯哥
测试凯哥
04-14 10:54
IP 属地北京
Demo用的react，那sdk可以接vue么？
武龙
武龙
05-06 09:24
IP 属地安徽
可以的
夏季的暴风雨
夏季的暴风雨
04-15 21:08
IP 属地河南
这是怎么回事
武龙
武龙
05-06 09:24
IP 属地安徽
超拟人形象不支持透明背景，详细可以看下常见问题中的第15条
【研发部】巩法林
【研发部】巩法林
04-21 14:06
IP 属地北京
600000 必要参数缺失 InvalidParam InvalidParam: 必要参数缺失
【研发部】巩法林
【研发部】巩法林
04-21 14:07
IP 属地北京
@王大大
@赵伟振
@武龙
@杨学林
【研发部】巩法林
【研发部】巩法林
【研发部】巩法林
04-21 14:08
IP 属地北京
运行demo报错appId: '64679076'
vs
vs
05-07 09:21
IP 属地北京
引用原文：demo运行讲解视频 https://www.bilibili.com/video/BV1aHLbzRE1c/
视频需要登陆才能看，又得注册。
qqcm
qqcm
05-14 16:58
IP 属地湖北
流式发送文本的追加模式如何开启
武龙
武龙
08-25 14:37
IP 属地安徽
看下文本驱动协议，有参数控制是打断还是追加
在ni头上暴扣
在ni头上暴扣
05-20 15:26
IP 属地江苏
当音量设置为0时，数字人的口型能够动起来么？
武龙
武龙
08-25 14:36
IP 属地安徽
幅度会变得很小，虚拟人得口型会根据音量大小调整
刘俊
刘俊
05-24 13:24
IP 属地四川
html怎么集成，有没有demo
夕阳不落海
夕阳不落海
06-28 17:53
IP 属地湖南
这是·为什么啊
武龙
武龙
08-25 14:36
IP 属地安徽
感觉像是游览器版本问题。建议要用近代版本游览器
夕阳不落海
夕阳不落海
06-28 19:53
IP 属地湖南
已解决
Byte Beat
Byte Beat
07-23 12:59
IP 属地山西
怎么实现语音播报的同时，同步显示播报文字内容
武龙
武龙
08-25 14:35
IP 属地安徽
SetGlobalparams中有个subtitles开启字幕参数
@daniel li🐙
@daniel li🐙
08-04 16:52
IP 属地湖北
我的整个流程都显示正常，没有报错。但是id="xvideo"下面只有第一个div，数字人没有显示dom图片，chrome页面
武龙
武龙
08-25 14:34
IP 属地安徽
dom图片指的是什么呀
zhangzeshan

注册 7 天后即可参与评论 了解更多
39
12336/12336字
语雀
关于语雀使用帮助数据安全服务协议English
科大讯飞
讯飞虚拟人交互平台用户手册
搜索
Ctrl + J
首页
目录
大纲
Adblocker
